jQuery(document).ready(function () {    function media_upload(button_class) {        var _custom_media = true,                _orig_send_attachment = wp.media.editor.send.attachment;        jQuery('body').on('click', button_class, function (e) {            var button_id = '#' + jQuery(this).attr('id');            //console.log(button_id);            var tgm_media_frame;            if (tgm_media_frame) {                tgm_media_frame.open();                return;            }            tgm_media_frame = wp.media.frames.tgm_media_frame = wp.media({                //className: 'media-frame tgm-media-frame',                //frame: 'select',                //title: tgm_nmp_media.title,                multiple: true,                library: {                    type: 'image'                },            });            tgm_media_frame.on('select', function () {                var selection = tgm_media_frame.state().get('selection');                selection.map(function (model) {                    var thumbnail = model.attributes.url;                    if (model.attributes.sizes !== undefined && model.attributes.sizes.thumbnail !== undefined)                        thumbnail = model.attributes.sizes.thumbnail.url;                    jQuery(button_id).parent().prev().append('<span data-id="' + model.id + '" title="' + model.attributes.title + '"><img src="' + thumbnail + '" alt="" /><span class="close">x</span></span>');                    console.log(jQuery(button_id).parent().prev());                    jQuery(button_id).parent().prev().trigger('update');                });            });            tgm_media_frame.open();            jQuery(button_id).parent().prev().on('update', function () {                var ids = [];                var $val = jQuery(button_id).parent().prev().prev().children().eq(1);                jQuery(button_id).parent().prev().find('> span').each(function () {                    ids.push(jQuery(this).data('id'));                });                jQuery($val).attr('value', ids);            });            jQuery(button_id).parent().prev().sortable({                placeholder: "partners_img_area",                revert: 200,                tolerance: 'pointer',                stop: function () {                    jQuery(button_id).trigger('update');                }            });            jQuery(button_id).parent().prev().on('click', 'span.close', function (e) {                jQuery(this).parent().fadeOut(200, function () {                    jQuery(this).remove();                    jQuery(button_id).parent().prev().trigger('update');                });            });            return false;        });    }    media_upload('.custom_media_upload');    jQuery('.partners_img_area').on('update', function () {        var ids = [];        var $val = jQuery(this).prev().children().eq(1);        jQuery(this).find('> span').each(function () {            ids.push(jQuery(this).data('id'));        });        jQuery($val).attr('value', ids);    });    jQuery('.partners_img_area').sortable({        placeholder: "partners_img_area",        revert: 200,        tolerance: 'pointer',        stop: function () {            jQuery(this).trigger('update');        }    });    jQuery('.partners_img_area').on('click', 'span.close', function (e) {        var trigger = jQuery(this).parent().parent();        jQuery(this).parent().fadeOut(200, function () {            jQuery(this).remove();            jQuery(trigger).trigger('update');        });    });});