jQuery(document).ready(function(e){e.widget("ui.dialog",e.ui.dialog,{_allowInteraction:function(t){return!0}});tinymce.triggerSave=function(){e(this.editors,function(e){e.id.indexOf("bfi_")==-1&&e.save()})};e(window).data("pb_init")==undefined&&e(window).data("pb_init",!0).keydown(function(t){if(e(".ui-dialog:visible").length>0){if(t.keyCode==27){var n=!1;e(".ui-dialog:visible .ui-button-text").each(function(){if(n==1)return;if(e(this).html().toLowerCase()=="close"){e(this).trigger("click");n=!0}});t.preventDefault();return!1}if(t.keyCode==13){var n=!1;e(".ui-dialog:visible .ui-button-text").each(function(){if(n==1)return;if(e(this).html().toLowerCase()=="save"||e(this).html().toLowerCase()=="delete"){e(this).trigger("click");n=!0}});t.preventDefault();return!1}}});var t=1;e(".panels-container").each(function(){e(this).attr("id","pagebuilder"+t++);bfi_layouting.createMultiRow(e(this).attr("id"),[100])});e("button").button();e("button.add-section").unbind("click").click(function(t){t.preventDefault();e("*").blur();e("[id=dialog-section-new][data-ownerid="+e(this).parents(".panels-container").attr("id")+"]").dialog("open")});e(".grid-container").sortable({revert:100,handle:"button.move",cancel:"",opacity:.5}).disableSelection();e(".bfi-pagebuilder-dialog").each(function(){e(this).find("input[type=checkbox],select").change(function(){setTimeout(function(){jQuery(".bfi-pagebuilder-dialog:visible").find(".m").removeClass("last");jQuery(".bfi-pagebuilder-dialog:visible").find(".m:visible:last").addClass("last")},1)})});e("button.open-import-export").unbind("click").click(function(t){t.preventDefault();e("[id=dialog-copy-paste][data-ownerid="+e(this).parents(".panels-container").attr("id")+"]").dialog("open")});jQuery("[id=dialog-panel-new]").each(function(){var t=e(this).siblings(".panels-container").attr("id");e(this).attr("data-ownerid",t).dialog({autoOpen:!1,width:"80%",modal:!0,open:function(t,n){e(this).find("button:eq(0)").focus();setTimeout("jQuery('.ui-widget-overlay').unbind('click').click(function() {                           jQuery('.ui-dialog-content').dialog('close');                       });",100)}}).find(".panel-type").unbind("click").click(function(){bfi_layouting.createNewPanel(e(this).parents("[data-ownerid]").attr("data-ownerid"),e(this),!0);e(this).parent().parent().dialog("close")})});e("[id=dialog-section-new]").each(function(){var t=e(this).siblings(".panels-container").attr("id");e(this).attr("data-ownerid",t).dialog({autoOpen:!1,width:400,modal:!0,open:function(t,n){e(this).find("button:eq(0)").focus();setTimeout("jQuery('.ui-widget-overlay').unbind('click').click(function() {                           jQuery('.ui-dialog-content').dialog('close');                       });",100)}}).find("button").unbind("click").click(function(){var t=bfi_layouting.createMultiRow(e(this).parents("[id=dialog-section-new]").attr("data-ownerid"),e(this).data("widths"));e(this).parent().dialog("close")})});e("[id=dialog-section-change]").each(function(){var t=e(this).siblings(".panels-container").attr("id");e(this).attr("data-ownerid",t).dialog({autoOpen:!1,width:400,modal:!0,open:function(t,n){e(this).find("button:eq(0)").focus();setTimeout("jQuery('.ui-widget-overlay').unbind('click').click(function() {                           jQuery('.ui-dialog-content').dialog('close');                       });",100)}}).find("button").unbind("click").click(function(){var t=bfi_layouting.modifyRowColumns(e(this).parents("[id=dialog-section-change]").attr("data-ownerid"),e("#"+e(this).parents("[id=dialog-section-change]").data("row-id")),e(this).data("widths"));e(this).parent().dialog("close")})});e("[id=dialog-delete]").each(function(){var t=e(this).siblings(".panels-container").attr("id");e(this).attr("data-ownerid",t).dialog({autoOpen:!1,width:300,modal:!0,open:function(t,n){e(this).find(".delete").focus();setTimeout("jQuery('.ui-widget-overlay').unbind('click').click(function() {                         jQuery('.ui-dialog-content').dialog('close');                     });",100)}}).find("button.cancel").unbind("click").click(function(){e(this).parent().dialog("close")}).end().find("button.delete").unbind("click").click(function(){e("#"+e(this).parent().attr("data-ownerid")+" [id="+e(this).parent().data("delete-id")+"]").remove();e(this).parent().dialog("close")})});e("[id=dialog-copy-paste]").each(function(){var t=e(this).siblings(".panels-container").attr("id");e(this).attr("data-ownerid",t).dialog({autoOpen:!1,width:450,modal:!0,open:function(t,n){e(this).parent().find("textarea.export").val(bfi_layouting.encode64(bfi_layouting.getLayoutData(e(this).attr("data-ownerid"))));e(this).parent().find("textarea.import").val("");setTimeout("jQuery('.ui-widget-overlay').unbind('click').click(function() {                         jQuery('.ui-dialog-content').dialog('close');                     });",100)}}).find("button.import").unbind("click").click(function(){var t=bfi_layouting.decode64(e(this).parent().find("textarea.import").val());t!=""&&bfi_layouting.initPageBuilderData(e(this).parents("[id=dialog-copy-paste]").attr("data-ownerid"),t);e(this).parent().dialog("close")}).end().find("textarea.export").unbind("click").click(function(){e(this).select()}).end().find("textarea.import").unbind("click").click(function(){e(this).select()})});e(".bfi-pagebuilder-dialog").each(function(){e(this).find("textarea:not(.plain)").each(function(){e(this).attr("id","bfi_"+parseInt(Math.random()*1e5));tinyMCE.settings={mode:"textareas",wpautop:!0,mode:"none",plugins:"fullscreen",valid_elements:"-p,img[!src],-del,-ul[*],-li[*],-ol[*],-a[*],-strong/b,-em/i,-div[!style],-span[*],-h1[*],-h2[*],-h3[*],-h4[*],-h5[*],-h6[*],-blockquote[*],hr,br",force_br_newlines:!1,force_p_newlines:!0,forced_root_block:!1,convert_urls:!1,relative_urls:!1,remove_script_host:!1,verify_html:!1,language:null,theme_advanced_buttons1:"source,bold,italic,underline,strikethrough,highlight,|,justifyleft,justifycenter,justifyright,|,undo,redo",theme_advanced_buttons2:"styleselect,hr,blockquote,link,unlink,|,dropcap,dropcircle",theme_advanced_buttons3:"bullist,starbullist,checkbullist,xbullist,numlist,|,outdent,indent,|,fullscreen,code",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",style_formats:[{title:"Heading 1",block:"h1"},{title:"Heading 2",block:"h2"},{title:"Heading 3",block:"h3"},{title:"Heading 4",block:"h4"},{title:"Heading 5",block:"h5"},{title:"Heading 6",block:"h6"},{title:"Heading 1 Light",block:"h1",attributes:{"class":"light"}},{title:"Heading 2 Light",block:"h2",attributes:{"class":"light"}},{title:"Heading 3 Light",block:"h3",attributes:{"class":"light"}},{title:"Heading 4 Light",block:"h4",attributes:{"class":"light"}},{title:"Heading 5 Light",block:"h5",attributes:{"class":"light"}},{title:"Heading 6 Light",block:"h6",attributes:{"class":"light"}}],formats:{strikethrough:{inline:"del"}},setup:function(e){e.addButton("highlight",{title:"Highlight selected text",image:"",onclick:function(){e.focus();e.selection.setContent('<span class="bfi_highlight">'+e.selection.getContent()+"</span>")}});e.addButton("starbullist",{title:"Star bullets",image:"",cmd:"InsertUnorderedList",onclick:function(){e.focus();tinyMCE.execCommand("InsertUnorderedList");bfi_layouting.tinyMCEAddClassToParent(e,"ul","star")}});e.addButton("checkbullist",{title:"Check bullets",image:"",cmd:"InsertUnorderedList",onclick:function(){e.focus();tinyMCE.execCommand("InsertUnorderedList");bfi_layouting.tinyMCEAddClassToParent(e,"ul","check")}});e.addButton("xbullist",{title:"X bullets",image:"",cmd:"InsertUnorderedList",onclick:function(){e.focus();tinyMCE.execCommand("InsertUnorderedList");bfi_layouting.tinyMCEAddClassToParent(e,"ul","x")}});e.addButton("dropcap",{title:"Dropcaps",image:"",onclick:function(){e.focus();e.selection.setContent('<span class="dropcap">'+e.selection.getContent()+"</span>")}});e.addButton("dropcircle",{title:"Dropcaps Cricle",image:"",onclick:function(){e.focus();e.selection.setContent('<span class="dropcap_circle">'+e.selection.getContent()+"</span>")}})}};tinyMCE.addI18n("en.advanced",{style_select:"Styles",font_size:"Font size",fontdefault:"Font family",block:"Format",paragraph:"Paragraph",div:"Div",address:"Address",pre:"Preformatted",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",blockquote:"Blockquote",code:"Code",samp:"Code sample",dt:"Definition term ",dd:"Definition description",bold_desc:"Bold (Ctrl + B)",italic_desc:"Italic (Ctrl + I)",underline_desc:"Underline",striketrough_desc:"Strikethrough (Alt + Shift + D)",justifyleft_desc:"Align Left (Alt + Shift + L)",justifycenter_desc:"Align Center (Alt + Shift + C)",justifyright_desc:"Align Right (Alt + Shift + R)",justifyfull_desc:"Align Full (Alt + Shift + J)",bullist_desc:"Unordered list (Alt + Shift + U)",numlist_desc:"Ordered list (Alt + Shift + O)",outdent_desc:"Outdent",indent_desc:"Indent",undo_desc:"Undo (Ctrl + Z)",redo_desc:"Redo (Ctrl + Y)",link_desc:"Insert/edit link (Alt + Shift + A)",unlink_desc:"Unlink (Alt + Shift + S)",image_desc:"Insert/edit image (Alt + Shift + M)",cleanup_desc:"Cleanup messy code",code_desc:"Edit HTML Source",sub_desc:"Subscript",sup_desc:"Superscript",hr_desc:"Insert horizontal ruler",removeformat_desc:"Remove formatting",forecolor_desc:"Select text color",backcolor_desc:"Select background color",charmap_desc:"Insert custom character",visualaid_desc:"Toggle guidelines/invisible elements",anchor_desc:"Insert/edit anchor",cut_desc:"Cut",copy_desc:"Copy",paste_desc:"Paste",image_props_desc:"Image properties",newdocument_desc:"New document",help_desc:"Help",blockquote_desc:"Blockquote (Alt + Shift + Q)",clipboard_msg:"Copy/Cut/Paste is not available in Mozilla and Firefox.",path:"Path",newdocument:"Are you sure you want to clear all contents?",toolbar_focus:"Jump to tool buttons - Alt+Q, Jump to editor - Alt-Z, Jump to element path - Alt-X",more_colors:"More colors",shortcuts_desc:"Accessibility Help",help_shortcut:" Press ALT F10 for toolbar. Press ALT 0 for help.",rich_text_area:"Rich Text Area",toolbar:"Toolbar"});tinyMCE.execCommand("mceAddControl",!1,e(this).attr("id"))})});var n=1;e(".bfi-pagebuilder-dialog").each(function(){e(this).data("defaults",bfi_layouting.getDialogData(e(this)));var t=e(this).siblings(".panels-container").attr("id");e(this).attr("data-ownerid",t).dialog({autoOpen:!1,width:450,modal:!0,buttons:{Save:function(){e(this).dialog("close");bfi_layouting.saveDialogDataToPanel(e(this))},Cancel:function(){e(this).dialog("close")}},open:function(t,n){e(this).parents(".ui-dialog").find(".bfi-pagebuilder-dialog").css("maxHeight",jQuery(window).height()-200);var r=e("#"+e(this).attr("data-ownerid")).find("#"+e(this).data("panel"));r.length==0&&(r=e("#"+e(this).attr("data-ownerid")).find("#"+e(this).data("section")));bfi_layouting["preopen_"+e(this).attr("data-model")]!=undefined&&(r.data("properties")==""?bfi_layouting["preopen_"+e(this).attr("data-model")](e(this).data("defaults")):bfi_layouting["preopen_"+e(this).attr("data-model")](r.data("properties")));if(r.data("properties")==""){bfi_layouting.setDialogData(e(this),e(this).data("defaults"));bfi_layouting.saveDialogDataToPanel(e(this))}else bfi_layouting.setDialogData(e(this),e.extend(e.extend({},e(this).data("defaults")),r.data("properties")));e(this).parents(".ui-dialog").find("textarea:not(.plain)").each(function(){tinyMCE.get(e(this).attr("id")).setContent(e(this).val())});e(".mceIframeContainer iframe:not(.done)").each(function(){var t=frames[e(this).attr("id")].document,n=t.getElementsByTagName("head")[0],r=t.createElement("link");r.setAttribute("rel","stylesheet");r.setAttribute("type","text/css");r.setAttribute("href",BFI_PAGEBUILDER_EDITOR_CSS);n.appendChild(r);e(this).addClass("done")});setTimeout("jQuery('.ui-widget-overlay').unbind('click').click(function() {                         jQuery('.ui-dialog-content').dialog('close');                     });",100);e(this).find("input[type=checkbox],select").trigger("change");e(this).find(".option_selectIcon select").ddslick()},close:function(t,n){e(".dd-container").ddslick("destroy")}})});if(e(window).data("bfi-page-builder-resize-bind")==undefined){e(window).data("bfi-page-builder-resize-bind",!0);e(window).bind("resize",function(t){e(t.target).hasClass("ui-resizable")||e(".grid-container .row-container").each(function(){var t=e(this).width();t-=(e(this).children(".panel-container").length-1)*10;for(var n=0;n<e(this).children(".panel-container").length;n++)e(this).children(".panel-container").eq(n).width(parseFloat(e(this).children(".panel-container").eq(n).find(".measurement input").val())/100*t)})})}e(document).keypress(function(t){t.keyCode==27&&e(".ui-dialog-content:eq(0)").dialog("close")})});var bfi_layouting;(function(e){bfi_layouting={_currID:1,tinyMCEAddClassToParent:function(e,t,n){var r=e.selection.getNode();while(!e.dom.is(r,t)){if(e.dom.is(r,"html"))return;r=r.parentNode}e.dom.is(r,t)&&e.dom.addClass(r,n)},generateID:function(){return"bfi_elem_"+this._currID++},createMultiRow:function(t,n){var r="<div id="+this.generateID()+" class='row-container new'>             <div class='controls'>                 <button class='delete' title='Delete'>                     <i class='icon-remove'></i>                 </button>                 <button class='columns' title='Change Columns'>                     <i class='icon-th-large'></i>                 </button>                 <button class='settings' title='Styles'>                     <i class='icon-tint'></i>                 </button>                 <button class='link off' title='Link Styles to Top'>                     <i class='icon-link'></i>                 </button>                 <button class='clone' title='Clone'>                     <i class='icon-copy'></i>                 </button>                 <button class='move' title='Move'>                     <i class='icon-resize-vertical'></i>                 </button>             </div>";for(var i=0;i<n.length;i++)r+="<div class='panel-container ui-corner-all ui-widget ui-state-default'>                 <button class='add-panel-inside'><i class='icon-plus icon-large'></i> Panel</button>                 <div class='measurement'>                     <input type='text' value='"+n[i]+"%'/><hr>                 </div>                 </div>";r+="<div class='clearfix'></div></div>";e("#"+t+" .grid-container").append(r);r="";for(var i=0;i<n.length;i++){var s=parseFloat(n[i]),o=(n.length-1)*10,u=e("#"+t+" .grid-container").width();e(".row-container.new .panel-container:eq("+i+")").width((u-o)*s/100)}e(".row-container.new .add-panel-inside").unbind("click").click(function(t){e(this).parents(".panels-container").find(".grid-container > .row-container > .ui-selected").removeClass("ui-selected");e(this).parents(".panel-container:eq(0)").addClass("ui-selected");t.preventDefault();e("*").blur();e("[id=dialog-panel-new][data-ownerid="+e(this).parents(".panels-container").attr("id")+"]").dialog("open")});e(".row-container.new").data("properties","").find("button:not(.add-panel)").button().end().find("button[title]").tooltip({position:{my:"center bottom-8",at:"center top"},show:{effect:"fade",duration:200},hide:!1}).end().find(".controls button.columns").unbind("click").click(function(t){t.preventDefault();e("[id=dialog-section-change][data-ownerid="+e(this).parents(".panels-container").attr("id")+"]").data("row-id",e(this).parents(".row-container").attr("id")).dialog("open")}).end().find(".controls button.delete").unbind("click").click(function(t){t.preventDefault();e("[id=dialog-delete][data-ownerid="+e(this).parents(".panels-container").attr("id")+"]").data("delete-id",e(this).parents(".row-container").attr("id")).dialog("open")}).end().find(".controls button.clone").unbind("click").click(function(t){t.preventDefault();bfi_layouting.cloneSection(e(this).parents(".row-container"))}).end().find(".controls button.settings").unbind("click").click(function(t){t.preventDefault();bfi_layouting.editSectionProperties(e(this).parents(".row-container"))}).end().find(".controls button.link").unbind("click").click(function(t){t.preventDefault();e(this).toggleClass("off");e(this).parents(".controls").find("button.settings").toggleClass("off")});this.initPanelContainer(".row-container.new .panel-container");this.initRowContainer(".row-container.new");e("#"+t+" .grid-container > .row-container > .ui-selected").removeClass("ui-selected");e(".row-container.new .panel-container:eq(0)").addClass("ui-selected");return e("#"+t+" .grid-container .new").toggleClass("new")},createNewPanel:function(t,n,r){var i;e("#"+t+" .panel-container.ui-selected").length==0?i=e("#"+t+" .panel-container:eq(0)"):i=e("#"+t+" .panel-container.ui-selected");i.append("<div id="+this.generateID()+" class='new panel ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only'>                 <button class='delete' title='Delete'><i class='icon-remove'></i></button>                 <button class='edit' title='Edit'><i class='icon-pencil'></i></button>                 <button class='clone' title='Clone'><i class='icon-copy'></i></button>                 <span class='title'></span>                 <span class='preview'></span>                 <span class='desc'></span>             </div>");e("#"+t+" .panel.new").attr("data-class",n.attr("data-class")).attr("data-model",n.attr("data-model")).attr("data-is-container",n.attr("data-is-container")).data("properties","").find(".title").html(n.find(".name").html()).end().find(".desc").html(n.find(".desc").html()).end().find("button").button().end().find("button[title]").tooltip({position:{my:"center bottom-8",at:"center top"},show:{effect:"fade",duration:200},hide:!1}).end().find("button.delete").unbind("click").click(function(t){t.preventDefault();e("[id=dialog-delete][data-ownerid="+e(this).parents(".panels-container").attr("id")+"]").data("delete-id",e(this).parent().attr("id")).dialog("open")}).end().unbind("dblclick").dblclick(function(t){t.preventDefault();bfi_layouting.editPanel(e(this))}).find("button.clone").unbind("click").click(function(t){t.preventDefault();bfi_layouting.clonePanel(e(this).parents(".panel"))}).unbind("dblclick").dblclick(function(e){e.stopPropagation();e.preventDefault()}).end().find("button.edit").unbind("click").click(function(t){t.preventDefault();bfi_layouting.editPanel(e(this).parents(".panel"))});n.attr("data-is-container")&&this.initSubPanelContainer("#"+t+" .panel.new");return r?this.editPanel(e("#"+t+" .panel.new").toggleClass("new")):e("#"+t+" .panel.new").toggleClass("new")},updatePanelContainerPercentages:function(t){var n=0;t.parent().children(".panel-container").each(function(){n+=e(this).width()});var r=Math.round(t.width()/n*1e3)/10;t.find(".measurement input").val(r+"%");r=Math.round(t.next(".panel-container").width()/n*1e3)/10;t.next(".panel-container").find(".measurement input").val(r+"%")},updateResizeHandle:function(t){if(t.find(".resize-handle").length){var n=0,r=t.find(".panel-container");r.each(function(){e(this).height()>n&&(n=e(this).height())});n+=parseInt(r.css("paddingBottom"))+parseInt(r.css("paddingTop"));t.find(".resize-handle").height(n)}},getLayoutData:function(t){var n=[];e("#"+t+" .grid-container .row-container").each(function(){var t={properties:e(this).data("properties"),linked:!e(this).find(".controls .link").is(".off"),columns:[]};e(this).find(".panel-container").each(function(){var n={width:100,panels:[]},r=parseFloat(e(this).find(".measurement input").val());n.width=r;e(this).find(".panel").each(function(t){var r={preview:e(this).find(".preview").html(),type:e(this).attr("data-model"),i:t,data:e(this).data("properties")};n.panels.push(r)});t.columns.push(n)});n.push(t)});return JSON.stringify(n)},initSubPanelContainer:function(e){},initPanelContainer:function(t){e(t).each(function(){e(this).sortable({items:".panel",tolerance:"intersect",revert:100,placeholder:"placeholder",forcePlaceholderSize:!0,opacity:.5,connectWith:["#"+e(this).parents(".panels-container").attr("id")+" .panel-container, #"+e(this).parents(".panels-container").attr("id")+" [data-is-container='true']"],stop:function(e,t){t.item.parents(".panels-container").find(".grid-container > .row-container > .ui-selected").removeClass("ui-selected");t.item.parent(".ui-selectee").addClass("ui-selected");t.item.parents(".row-container").eq(0).trigger("updateResizeHandle")},sort:function(e,t){t.item.parents(".row-container").eq(0).trigger("updateResizeHandle")},start:function(e,t){t.item.parents(".panels-container").find("*").blur()}})});e(t).disableSelection();e(t).find(".measurement input").attr("disabled","disabled")},initRowContainer:function(t){e(t).selectable({selecting:function(t,n){e(this).parents(".panels-container").find(".grid-container > .row-container > .ui-selected").removeClass("ui-selected");e(this).parents(".panels-container").find("*").blur()}}).disableSelection();e(t).each(function(){e(this).children(".panel-container:not(:last)").addClass("has-resize-handle").resizable({handles:"e",resize:function(e,t){t.element.next().width(t.element.data("nextStartWidth")+(t.element.data("startWidth")-t.element.width()));bfi_layouting.updatePanelContainerPercentages(t.element)},start:function(t,n){n.element.data("startWidth",n.element.width());n.element.data("nextStartWidth",n.element.next().width());n.element.resizable("option","minWidth",0);n.element.resizable("option","maxWidth",n.element.width()+n.element.next().width()-n.element.resizable("option","minWidth"));e("*").blur()}})});e(t).each(function(){e(this).children(".panel-container:not(:last)").trigger("resize")}).bind("updateResizeHandle",function(){bfi_layouting.updateResizeHandle(e(this))})},clonePanel:function(t){e(t).clone(!0).attr("id",this.generateID()).appendTo(e(t).parents(".panel-container")).addClass("new").find(".ui-state-hover").removeClass("ui-state-hover");e(t).after(e(".panel.new").removeClass("new"));e(".ui-tooltip").remove()},cloneSection:function(t){var n=[];e(t).find(".measurement input").each(function(t){n[t]=parseFloat(e(this).val())});var r=this.createMultiRow(e(t).parents(".panels-container").attr("id"),n);if(e(t).find(".controls button.link.off").length>0){r.find(".controls button.link").addClass("off");r.find(".controls button.settings").removeClass("off")}else{r.find(".controls button.link").removeClass("off");r.find(".controls button.settings").addClass("off")}r.data("properties",e(t).data("properties"));e(t).find(".panel-container").each(function(t){e(this).find(".panel").each(function(n){e(this).clone(!0).attr("id",bfi_layouting.generateID()).appendTo(e(this).parents(".panels-container").find(".row-container:last .panel-container:eq("+t+")")).find(".ui-state-hover").removeClass("ui-state-hover")})});e(t).after(e(t).parents(".panels-container").find(".row-container:last"));e(".ui-tooltip").remove()},editPanel:function(t){e(".bfi-pagebuilder-dialog[data-model="+e(t).attr("data-model")+"][data-ownerid="+e(t).parents(".panels-container").attr("id")+"]").data("panel",e(t).attr("id")).dialog("open");return e(t)},getDialogData:function(t){var n=[];e(t).find("[name^="+BFI_SHORTNAME+"_]").each(function(){var t=e(this).attr("name");n.indexOf(t)==-1&&n.push(t)});var r={};e.each(n,function(n,i){var s=i.replace(BFI_SHORTNAME+"_","").replace("[]","");if(i.indexOf("[]")!=-1){var o=[];e(t).find('[name="'+i+'"]:checked').each(function(){o.push(e(this).val())});r[s]=o}else{if(e(t).find("[name="+i+"]").is("[type=checkbox]"))r[s]=e(t).find("[name="+i+"]").is(":checked");else if(e(t).find("[name="+i+"]").is("textarea:not(.plain)")&&e(t).find("[name="+i+"]").next().is(".mceEditor")){r[s]=tinyMCE.get(e(t).find("[name="+i+"]").attr("id")).getContent();r[s]=r[s].replace(/font-family\:[^;]+;?/g,"");r[s]=r[s].replace(/font-size\:[^;]+;?/g,"");r[s]=r[s].replace(/font\:[^;]+;?/g,"")}else r[s]=e(t).find("[name="+i+"]").val();r[s]=bfi_layouting.cleanUpText(r[s])}});return r},cleanUpText:function(e){e=typeof e=="string"?e.replace(/'/g,"&apos;"):e;return e},saveDialogDataToPanel:function(t){var n=e("#"+e(t).attr("data-ownerid")).find("#"+e(t).data("panel"));n.length==0&&(n=e("#"+e(t).attr("data-ownerid")).find("#"+e(t).data("section")));this.updatePanelPreview(t);n.data("properties",this.getDialogData(t))},updatePanelPreview:function(t){var n=e("#"+e(t).attr("data-ownerid")).find("#"+e(t).data("panel"));if(n.length==0)return;var r="";e(t).find("select,input,textarea").each(function(){var t="";e(this).is("select")?t=e(this).find("option[value="+e(this).val()+"]").text():e(this).is('input[type=checkbox][name*="[]"]')?e(this).is(":checked")&&(t=e(this).next("span").text()):e(this).is("input[type=checkbox]")?t="":e(this).is("textarea:not(.plain)")?t=e("<div>").html(tinyMCE.get(e(this).attr("id")).getContent()).text():t=e("<div>").html(e(this).val()).text();if(t!=""){r+=r?", ":"";r+=t}});r==""?r="(EMPTY)":r.length>50&&(r=e.trim(r).substring(0,50)+"...");n.find(".preview").html(r)},setDialogData:function(t,n){e.each(n,function(n,r){n=BFI_SHORTNAME+"_"+n;if(typeof r=="boolean")e(t).find('[name="'+n+'"]').prop("checked",r);else if(typeof r=="object"){n+="[]";e(t).find('[name="'+n+'"]').prop("checked",!1);e.each(r,function(r,i){e(t).find('[name="'+n+'"][value="'+i+'"]').prop("checked",!0)})}else e(t).find('[name="'+n+'"]').next().is(".colorSelector")?e(t).find('[name="'+n+'"]').val(r).next(".colorSelector").find("> div").css("backgroundColor",r):e(t).find('[name="'+n+'"]').val(r.replace(/&apos;/g,"'"))})},editSectionProperties:function(t){e(".bfi-pagebuilder-dialog[data-model="+SECTION_PROPERTIES_MODEL+"][data-ownerid="+e(t).parents(".panels-container").attr("id")+"]").data("section",e(t).attr("id")).dialog("open")},modifyRowColumns:function(t,n,r){var i=e(n).find(".panel-container").length,s=r.length,o=this.createMultiRow(t,r);if(e(n).find(".controls button.link.off").length>0){o.find(".controls button.link").addClass("off");o.find(".controls button.settings").removeClass("off")}else{o.find(".controls button.link").removeClass("off");o.find(".controls button.settings").addClass("off")}o.data("properties",e(n).data("properties"));e(n).find(".panel-container").each(function(t){e(this).find(".panel").each(function(n){var r=t;t>s-1&&i>s&&(r=s-1);e(this).clone(!0).attr("id",bfi_layouting.generateID()).appendTo(o.find(".panel-container:eq("+r+")")).find(".ui-state-hover").removeClass("ui-state-hover")})});e(n).after(e(n).parents(".panels-container").find(".row-container:last"));e(n).remove();e(".ui-tooltip").remove()},initPageBuilderData:function(t,n){var r=this.getLayoutData(t);try{if(typeof n=="string"){n=this.cleanUpText(n);try{n=JSON.parse(n)}catch(i){n='[{"properties":"","columns":[{"width":100,"panels":[]}]}]'}}e("#"+t+" .row-container").remove();e.each(n,function(n,r){var i=[];e.each(r.columns,function(e,t){i.push(t.width)});var s=bfi_layouting.createMultiRow(t,i).data("properties",r.properties);if(r.linked){s.find(".controls .link").removeClass("off");s.find(".controls .settings").addClass("off")}e.each(r.columns,function(n,r){e.each(r.panels,function(r,i){var s=e("#"+t+" .row-container:last").find(".panel-container").eq(n);e("#"+t).find(".grid-container > .row-container > .ui-selected").removeClass("ui-selected");s.addClass("ui-selected");var o=bfi_layouting.createNewPanel(t,e('.panel-type[data-model="'+i.type+'"]:eq(0)'),!1);o.data("properties",i.data);i.preview!=undefined&&o.find(".preview").html(i.preview)})})})}catch(i){alert("The import data is invalid.");this.initPageBuilderData(t,r)}},encode64:function(e){keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";e=escape(e);var t="",n,r,i="",s,o,u,a="",f=0;do{n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;isNaN(r)?u=a=64:isNaN(i)&&(a=64);t=t+keyStr.charAt(s)+keyStr.charAt(o)+keyStr.charAt(u)+keyStr.charAt(a);n=r=i="";s=o=u=a=""}while(f<e.length);return t},decode64:function(e){keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var t="",n,r,i="",s,o,u,a="",f=0,l=/[^A-Za-z0-9\+\/\=]/g;if(l.exec(e)){alert("There were invalid base64 characters in the input text.\nThe data is invalid, importing failed.");return""}e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do{s=keyStr.indexOf(e.charAt(f++));o=keyStr.indexOf(e.charAt(f++));u=keyStr.indexOf(e.charAt(f++));a=keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t+=String.fromCharCode(n);u!=64&&(t+=String.fromCharCode(r));a!=64&&(t+=String.fromCharCode(i));n=r=i="";s=o=u=a=""}while(f<e.length);return unescape(t)}}})(jQuery);